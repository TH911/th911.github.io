---
layout: post
title: "浅谈平衡树"
subtitle: "各类平衡树概述"
date: 2025-1-21
author: "TH911"
header-img: "img/2024/10/006.jpeg"
header-mask: 0.4
tags:
  - 平衡树
  - Trie
  - 01Trie
  - FHQ Treap
  - Splay
  - 树状数组
  - 线段树
  - 基础算法
words:
  - 权值树状数组
  - 权值线段树
---

# 平衡树是什么

## 二叉搜索树 BST

BST，二叉搜索树，又名二叉查找树、二叉排序树，是一种特殊的二叉树。能够保证**中序遍历**是有序的。

最理想的情况下，BST 的树高为 $\mathcal O(\log n)$，但是可能会变成 $\mathcal O(n)$。

## 维持树高

一棵较为理想的 BST：

![](/img/2025/01/014.png)

但是可能会因为输入顺序等原因变为：

![](/img/2025/01/015.png)

这样就很不好。

因此，我们可以通过各种平衡树来使树高维持在 $\mathcal O(\log n)$ 。

## 实现方式

平衡树的实现方式有很多，**平衡树更多的是一个概念上的数据结构，没有固定样式**。

一般来讲，能够实现[普通平衡树](https://www.luogu.com.cn/problem/P3369)中的四个基础操作（插入、删除、查排名、查第 $k$ 大）的数据结构都能够称之为平衡树。

比如说 [01Trie](/2025/01/19/2/#平衡树)，比如说 [FHQ Treap](/2024/11/21/5/)。

甚至于，**权值树状数组**、**权值线段树**也能够算作平衡树。

# 平衡树的原理

平衡树主要原理就是限制树高或者大小。

## 重构

**替罪羊树**。

替罪羊树的原理就是当左右两个子树的大小差别超过一定量的时候，就将**子树**（不是整棵树）放入数组重构。

## 随机选择父节点

**Treap** 与 [**FHQ Treap**](/2024/11/21/5/)。

平衡树需要抉择的无非就是树高。

那么对于两个节点，随机选择一个当作父节点，可以证明每一个节点的**期望**高度都是 $\mathcal O(\log n)$。

## 旋转

**AVL 树**。

AVL 树会设置一个**平衡因子**并维护子树高度。当左、右两棵子树的高度差大于等于平衡因子的时候就进行旋转，来保证高度差小于等于 $1$。

<details class="note" open>
    <summary>旋转</summary>

    <p>
        旋转是一个很<b>重要</b>的操作。分四种类型：
    </p>
    <p>
    	<ul>
    		<li>LL 型：$T$ 的<b>左</b>孩子的<b>左</b>子树过长</li>
    		<b>右旋</b>节点 $T$。
    		<img src="/img/2025/01/016.svg">
    		<li>RR 型：$T$ 的<b>右</b>孩子的<b>右</b>子树过长</li>
    		<b>左旋</b>节点 $T$。
    		<img src="/img/2025/01/017.svg">
    		<li>LR 型：$T$ 的<b>左</b>孩子的<b>右</b>子树过长</li>
    		<b>左旋</b>节点 $L$ 成为LL型再<b>右旋</b>节点 $T$。
    		<img src="/img/2025/01/018.svg">
    		<li>RL 型：$T$ 的<b>右</b>孩子的<b>左</b>子树过长</li>
    		<b>右旋</b>节点 $R$ 成为RR型再<b>左旋</b>节点 $T$。
    		<img src="/img/2025/01/019.svg">
    	</ul>
    	<hr>
        事实上，<b>左旋</b>和<b>右旋</b>很多时候是混的……因为不同人对于这俩的叫法不一样……
    </p>
    <p>
    	值得一提的是，大多数情况下，<b>右</b>旋是将<b>左</b>孩子转上去，<b>左</b>旋是将<b>右</b>孩子转下来。
    </p>
</details>

然而 AVL 树存在四种情况，导致代码过长，一般不会用于 OI。

## 旋转至根节点

[**Splay 树**](/2025/01/22/1/)。

**Splay 树**通过不断将操作的节点**旋转至根节点**来使得均摊复杂度为 $\mathcal O(\log n)$。

## [01Trie](/2025/01/19/2/#平衡树)

按照二进制位来存储，插入、删除类似于字符串，求排名可以给叶子节点赋权值求和，查第 $k$ 大同理。

## 权值树状数组

需要离散化。

## 权值线段树

需要离散化。
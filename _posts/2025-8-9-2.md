---
layout: post
title: "题解：[NOIP2021] 方差"
subtitle: "洛谷P7962"
date: 2025-8-9
author: "TH911"
header-img: "img/2024/10/006.jpeg"
header-mask: 0.4
tags:
  - 题解
  - 省选/NOI−
  - 性质题
  - DP
words:
---

> [题目传送门](https://www.luogu.com.cn/problem/P7962)

# 测试点 $1\sim8$

首先，题目的操作即**交换差分**。

将答案变式：

$$
\begin{aligned}
n^2\cdot\dfrac1n\sum_{i=1}^n\left(a_i-\overline{a}\right)^2&=n\sum_{i=1}^n\left(a_i-\overline{a}\right)^2\\
&=n\sum_{i=1}^n\left(a_i-\dfrac1n\sum_{i=1}^na_i\right)^2\\
&=n\sum_{i=1}^n\left(a_i^2-2a_i\dfrac1n\sum_{i=1}^na_i+\left(\dfrac1n\sum_{i=1}^na_i\right)^2\right)\\
&=n\sum_{i=1}^na_i^2-2\left(\sum_{i=1}^na_i\right)^2+\left(\sum_{i=1}^na_i\right)^2\\
&=n\sum_{i=1}^na_i^2-\left(\sum_{i=1}^na_i\right)^2
\end{aligned}
$$

因此，求得差分 $$\textit{diff}_i=a_i-a_{i-1}$$ 后，对 $\textit{diff}_2,\textit{diff}_3,\cdots,\textit{diff}_n$ **全排列**，每次 $\mathcal O(n)$ 统计答案即可。

渐进时间复杂度上界为 $\mathcal O((n-1)!)$，可以通过测试点 $1\sim5$。但是注意到测试点 $6\sim8$ 的值域较小，因此本质不同的 $\textit{diff}_i$ 不多，仍然可以通过。

期望得分：$\text{32pts}$。

<details class="success">
    <summary>参考代码</summary>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-responsive"><table class="rouge-table table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
</pre></td><td class="rouge-code"><pre><span class="c1">//#include&lt;bits/stdc++.h&gt;</span>
<span class="cp">#include</span><span class="cpf">&lt;algorithm&gt;</span><span class="cp">
#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp">
#include</span><span class="cpf">&lt;cstring&gt;</span><span class="cp">
#include</span><span class="cpf">&lt;iomanip&gt;</span><span class="cp">
#include</span><span class="cpf">&lt;cstdio&gt;</span><span class="cp">
#include</span><span class="cpf">&lt;string&gt;</span><span class="cp">
#include</span><span class="cpf">&lt;vector&gt;</span><span class="cp">
#include</span><span class="cpf">&lt;cmath&gt;</span><span class="cp">
#include</span><span class="cpf">&lt;ctime&gt;</span><span class="cp">
#include</span><span class="cpf">&lt;deque&gt;</span><span class="cp">
#include</span><span class="cpf">&lt;queue&gt;</span><span class="cp">
#include</span><span class="cpf">&lt;stack&gt;</span><span class="cp">
#include</span><span class="cpf">&lt;list&gt;</span><span class="cp">
</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">constexpr</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">N</span><span class="o">=</span><span class="mf">1e4</span><span class="p">,</span><span class="n">V</span><span class="o">=</span><span class="mi">600</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="n">a</span><span class="p">[</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">diff</span><span class="p">[</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
	<span class="cm">/*freopen("test.in","r",stdin);
	freopen("test.out","w",stdout);*/</span>

	<span class="n">ios</span><span class="o">::</span><span class="n">sync_with_stdio</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
	<span class="n">cin</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="n">cout</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
	
	<span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">n</span><span class="p">;</span>
	<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
		<span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="n">diff</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
	<span class="p">}</span>
	<span class="n">sort</span><span class="p">(</span><span class="n">diff</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">diff</span><span class="o">+</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">ans</span><span class="o">=</span><span class="mi">2147483647</span><span class="p">;</span>
	<span class="k">do</span><span class="p">{</span>
		<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
			<span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">diff</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="p">}</span>
		<span class="kt">int</span> <span class="n">pl</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
		<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
			<span class="n">pl</span><span class="o">+=</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="p">}</span>
		<span class="n">pl</span><span class="o">*=</span><span class="n">n</span><span class="p">;</span>
		<span class="kt">int</span> <span class="n">sum</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
		<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
			<span class="n">sum</span><span class="o">+=</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="p">}</span>
		<span class="n">ans</span><span class="o">=</span><span class="n">min</span><span class="p">(</span><span class="n">ans</span><span class="p">,</span><span class="n">pl</span><span class="o">-</span><span class="n">sum</span><span class="o">*</span><span class="n">sum</span><span class="p">);</span>
	<span class="p">}</span><span class="k">while</span><span class="p">(</span><span class="n">next_permutation</span><span class="p">(</span><span class="n">diff</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">diff</span><span class="o">+</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">));</span>
	<span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">ans</span><span class="o">&lt;&lt;</span><span class="sc">'\n'</span><span class="p">;</span>
	
	<span class="n">cout</span><span class="p">.</span><span class="n">flush</span><span class="p">();</span>
	
	<span class="cm">/*fclose(stdin);
	fclose(stdout);*/</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
</details>

# 测试点 $9\sim22$

交换差分的操作具有一个性质：最终方差最小时，差分 $\textit{diff}_2,\textit{diff}_3,\cdots,\textit{diff}_n$ 是**单谷**的。

即中间存在一个最小值 $$\textit{diff}_i$$，对于 $1<j<i$，差分单调不增，有 $$\textit{diff}_j\geq\textit{diff}_{j+1}$$；对于 $i<j$，差分单调不降，有 $$\textit{diff}_{j-1}\leq\textit{diff}_j$$。

<details class="note">
    <summary>证明</summary>
    <p>
        记 $\overline a$ 为 $a_1,a_2,\cdots,a_n$ 的平均值。<b>假设差分单谷成立</b>。
    </p>
    <ul>
        <li>对于 $a_i&lt;\overline a$ 的前半部分，可以发现差分单调递减时更优。因为这样会有更多元素接近于 $\overline a$。
        </li>
        <li>
        对于 $\overline a&lt;a_i$ 的后半部分，可以发现差分单调递增时更优。因为这样会有更多元素接近于 $\overline a$。
        </li>
    </ul>
    <hr>
    <p>
        当差分不为单谷时，可以通过交换差分的方式，将其交换为单谷的形式，这样更优。
    </p>
</details>

***

在此之后，便考虑 DP 求解。

为了便于 DP，重定义 $$\textit{diff}_i=a_{i+1}-a_i,\textit{pre}_i=\sum\limits_{j=1}^i\textit{diff}_j$$。

不妨令 $$\textit{diff}_1,\textit{diff}_2,\cdots,\textit{diff}_{n-1}$$ 单调不降。

设 $$\textit{dp}_{i,j}$$ 表示插入了 $$\textit{diff}_1,\textit{diff}_2,\cdots,\textit{diff}_{i-1}$$ 后，使得 $\sum\limits_{k=1}^{i-1}a_k=j$ 的最小的 $\sum\limits_{k=1}^{i-1}a_k^2$。答案即：

$$
\min\limits_{i=0}^{n\cdot a_n}\left(n\cdot\textit{dp}_{n,i}-i^2\right)
$$

显然有 DP 边界：

$$
\textit{dp}_{1,0}=0
$$

考虑从左右两边分别插入 $\textit{diff}_i$，有：

$$
\begin{aligned}
\textit{dp}_{i+1,j+i\cdot\textit{diff}_i}&\leftarrow\min\left(\textit{dp}_{i+1,j+i\cdot\textit{diff}_i},\textit{dp}_{i,j}+2j\cdot\textit{diff}_i+i\cdot\textit{diff}_i^2\right)\\
\textit{dp}_{i+1,j+\textit{pre}_i}&\leftarrow\min\left(\textit{dp}_{i+1,j+\textit{pre}_i},\textit{dp}_{i,j}+\textit{pre}_i^2\right)\\
\end{aligned}
$$

时间复杂度：$\mathcal O\left(n^2V\right)$。滚动数组优化即可避免 MLE。

期望得分：$\text{88pts}$。

<details class="success">
    <summary>参考代码</summary>
<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-responsive"><table class="rouge-table table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
</pre></td><td class="rouge-code"><pre><span class="c1">//#include&lt;bits/stdc++.h&gt;</span>
<span class="cp">#include</span><span class="cpf">&lt;algorithm&gt;</span><span class="cp">
#include</span><span class="cpf">&lt;iostream&gt;</span><span class="cp">
#include</span><span class="cpf">&lt;cstring&gt;</span><span class="cp">
#include</span><span class="cpf">&lt;iomanip&gt;</span><span class="cp">
#include</span><span class="cpf">&lt;cstdio&gt;</span><span class="cp">
#include</span><span class="cpf">&lt;string&gt;</span><span class="cp">
#include</span><span class="cpf">&lt;vector&gt;</span><span class="cp">
#include</span><span class="cpf">&lt;cmath&gt;</span><span class="cp">
#include</span><span class="cpf">&lt;ctime&gt;</span><span class="cp">
#include</span><span class="cpf">&lt;deque&gt;</span><span class="cp">
#include</span><span class="cpf">&lt;queue&gt;</span><span class="cp">
#include</span><span class="cpf">&lt;stack&gt;</span><span class="cp">
#include</span><span class="cpf">&lt;list&gt;</span><span class="cp">
</span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
<span class="k">typedef</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">ll</span><span class="p">;</span>
<span class="k">constexpr</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">N</span><span class="o">=</span><span class="mf">1e4</span><span class="p">,</span><span class="n">V</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span><span class="n">Size</span><span class="o">=</span><span class="mf">5e5</span><span class="p">;</span>
<span class="k">constexpr</span> <span class="k">const</span> <span class="n">ll</span> <span class="n">inf</span><span class="o">=</span><span class="mh">0x3f3f3f3f3f3f3f3f</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">n</span><span class="p">,</span><span class="n">a</span><span class="p">[</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">diff</span><span class="p">[</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">pre</span><span class="p">[</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
<span class="n">ll</span> <span class="n">dp</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">Size</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
	<span class="cm">/*freopen("test.in","r",stdin);
	freopen("test.out","w",stdout);*/</span>

	<span class="n">ios</span><span class="o">::</span><span class="n">sync_with_stdio</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
	<span class="n">cin</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="n">cout</span><span class="p">.</span><span class="n">tie</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
	
	<span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">n</span><span class="p">;</span>
	<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
		<span class="n">cin</span><span class="o">&gt;&gt;</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
	<span class="p">}</span>
	<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
		<span class="n">diff</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
	<span class="p">}</span>
	<span class="n">sort</span><span class="p">(</span><span class="n">diff</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">diff</span><span class="o">+</span><span class="n">n</span><span class="p">);</span>
	<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
		<span class="n">pre</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">pre</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">diff</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
	<span class="p">}</span>
	<span class="n">memset</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span><span class="mh">0x3f</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">dp</span><span class="p">));</span>
	<span class="kt">bool</span> <span class="n">mode</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
	<span class="n">dp</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
	<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
		<span class="n">mode</span><span class="o">=!</span><span class="n">mode</span><span class="p">;</span>
		<span class="n">memset</span><span class="p">(</span><span class="n">dp</span><span class="p">[</span><span class="o">!</span><span class="n">mode</span><span class="p">],</span><span class="mh">0x3f</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">dp</span><span class="p">[</span><span class="o">!</span><span class="n">mode</span><span class="p">]));</span>
		<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">j</span><span class="o">&lt;=</span><span class="n">n</span><span class="o">*</span><span class="n">a</span><span class="p">[</span><span class="n">n</span><span class="p">];</span><span class="n">j</span><span class="o">++</span><span class="p">){</span>
			<span class="k">if</span><span class="p">(</span><span class="n">dp</span><span class="p">[</span><span class="n">mode</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">==</span><span class="n">inf</span><span class="p">){</span>
				<span class="k">continue</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="n">dp</span><span class="p">[</span><span class="o">!</span><span class="n">mode</span><span class="p">][</span><span class="n">j</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="n">diff</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">=</span><span class="n">min</span><span class="p">(</span><span class="n">dp</span><span class="p">[</span><span class="o">!</span><span class="n">mode</span><span class="p">][</span><span class="n">j</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="n">diff</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span><span class="n">dp</span><span class="p">[</span><span class="n">mode</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2ll</span><span class="o">*</span><span class="n">j</span><span class="o">*</span><span class="n">diff</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1ll</span><span class="o">*</span><span class="n">i</span><span class="o">*</span><span class="n">diff</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">diff</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
			<span class="n">dp</span><span class="p">[</span><span class="o">!</span><span class="n">mode</span><span class="p">][</span><span class="n">j</span><span class="o">+</span><span class="n">pre</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">=</span><span class="n">min</span><span class="p">(</span><span class="n">dp</span><span class="p">[</span><span class="o">!</span><span class="n">mode</span><span class="p">][</span><span class="n">j</span><span class="o">+</span><span class="n">pre</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span><span class="n">dp</span><span class="p">[</span><span class="n">mode</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="mi">1ll</span><span class="o">*</span><span class="n">pre</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">pre</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">ll</span> <span class="n">ans</span><span class="o">=</span><span class="n">inf</span><span class="p">;</span>
	<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="o">*</span><span class="n">a</span><span class="p">[</span><span class="n">n</span><span class="p">];</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
		<span class="k">if</span><span class="p">(</span><span class="n">dp</span><span class="p">[</span><span class="o">!</span><span class="n">mode</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="n">inf</span><span class="p">){</span>
			<span class="k">continue</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">ans</span><span class="o">=</span><span class="n">min</span><span class="p">(</span><span class="n">ans</span><span class="p">,</span><span class="n">n</span><span class="o">*</span><span class="n">dp</span><span class="p">[</span><span class="o">!</span><span class="n">mode</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mi">1ll</span><span class="o">*</span><span class="n">i</span><span class="o">*</span><span class="n">i</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">cout</span><span class="o">&lt;&lt;</span><span class="n">ans</span><span class="o">&lt;&lt;</span><span class="sc">'\n'</span><span class="p">;</span>
	
	<span class="n">cout</span><span class="p">.</span><span class="n">flush</span><span class="p">();</span>
	
	<span class="cm">/*fclose(stdin);
	fclose(stdout);*/</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
</details>

# 测试点 $23\sim25$

注意到当 $n=10^4$ 时，$\mathcal O\left(n^2V\right)$ 不再能被接受。

但是注意到此时 $V=50$ 较小，因此必然会有很多重复的 $a_i$，因此会有很多 $\textit{diff}_i=0$。对于这一部分无需进行转移，可以跳过。

因此可以做到 $\mathcal O\left(\min(n,V)nV\right)$ 的时间复杂度。

期望得分：$\text{100pts}$。

# AC 代码

```cpp
//#include<bits/stdc++.h>
#include<algorithm>
#include<iostream>
#include<cstring>
#include<iomanip>
#include<cstdio>
#include<string>
#include<vector>
#include<cmath>
#include<ctime>
#include<deque>
#include<queue>
#include<stack>
#include<list>
using namespace std;
typedef long long ll;
constexpr const int N=1e4,V=600,Size=5e5;
constexpr const ll inf=0x3f3f3f3f3f3f3f3f;
int n,a[N+1],diff[N+1],pre[N+1];
ll dp[2][Size+1];
int main(){
	/*freopen("test.in","r",stdin);
	freopen("test.out","w",stdout);*/
	
	ios::sync_with_stdio(false);
	cin.tie(0);cout.tie(0);
	
	cin>>n;
	for(int i=1;i<=n;i++){
		cin>>a[i];
	}
	for(int i=1;i<n;i++){
		diff[i]=a[i+1]-a[i];
	}
	sort(diff+1,diff+n);
	for(int i=1;i<n;i++){
		pre[i]=pre[i-1]+diff[i];
	}
	memset(dp,0x3f,sizeof(dp));
	bool mode=0;
	dp[1][0]=0;
	for(int i=1;i<n;i++){
		if(!diff[i]){
			continue;
		}
		mode=!mode;
		memset(dp[!mode],0x3f,sizeof(dp[!mode]));
		for(int j=0;j<=n*a[n];j++){
			if(dp[mode][j]==inf){
				continue;
			}
			dp[!mode][j+i*diff[i]]=min(dp[!mode][j+i*diff[i]],dp[mode][j] + 2ll*j*diff[i] + 1ll*i*diff[i]*diff[i]);
			dp[!mode][j+pre[i]]=min(dp[!mode][j+pre[i]],dp[mode][j]+1ll*pre[i]*pre[i]);
		}
	}
	ll ans=inf;
	for(int i=0;i<=n*a[n];i++){
		if(dp[!mode][i]==inf){
			continue;
		}
		ans=min(ans,n*dp[!mode][i]-1ll*i*i);
	}
	cout<<ans<<'\n';

	cout.flush();
	
	/*fclose(stdin);
	fclose(stdout);*/
	return 0;
}
```

---
layout: post
title: "FHQ Treap(无旋 Treap)详解"
subtitle: "例题：普通平衡树 | 洛谷P33699"
date: 2024-11-21
author: "TH911"
header-img: "img/2024/10/006.jpeg"
header-mask: 0.4
tags:
  - 提高+/省选−
  - 平衡树
  - FHQ Treap
---

> [例题链接](https://www.luogu.com.cn/problem/P3369)

> 您需要写一种数据结构（可参考题目标题），来维护一些数，其中需要提供以下操作：
>
> 1. 插入一个数 $x$。
> 2. 删除一个数 $x$（若有多个相同的数，应只删除一个）。
> 3. 定义**排名**为比当前数小的数的个数 $+1$。查询 $x$ 的排名。
> 4. 查询数据结构中排名为 $x$ 的数。
> 5. 求 $x$ 的前驱（前驱定义为小于 $x$，且最大的数）。
> 6. 求 $x$ 的后继（后继定义为大于 $x$，且最小的数）。
>
> 对于操作 $3,5,6$，**不保证**当前数据结构中存在数 $x$。

## 平衡树

什么是平衡树呢？

首先你需要了解二叉搜索树。

那么，二叉搜索树又是什么呢？

简单而言，就是一棵二叉树，满足对于任意节点 $x$，其左、右节点 $l_x,r_x$ 满足 $\large value_{l_x}<value_x<value_{r_x}$。（当然，大于也行）

这样我们便可以很方便的作树上查找等处理，但是这样有可能会被卡成一条长度接近于 $n$ 的单链（令节点数为 $n$），最终时间复杂度退化为 $\mathcal O(n)$。

因此，平衡树应运而生。

平衡树通过一些操作来使得从根节点出发的单链长度为 $\mathcal O(\log_2n)$，从根节点到任意叶节点的路径长度差不超过 $1$。

这些操作**包括但不限于**：旋转（如“Splay 树”、“Treap”）、重构（如“替罪羊树”）、分裂与合并（如“FHQ Treap”）。

## FHQ Treap（无旋 Treap）

### 命名由来

因为 FHQ Treap 由范浩强发明。因此名为“FHQ Treap”。

### Treap 特征

无论是旋转式Treap 还是 FHQ Treap，都同时满足二叉搜索树的性质与堆的性质。

具体而言，Treap 在维护基本权值的同时还维护了一个**随机优先级**，**权值满足二叉搜索树的性质**，**优先级满足堆的性质**（大根堆和小根堆随意）。

如图：

![](/img/2024/11/025.svg)

<div style="text-align: center;color: grey;font-size: 12px">图片来源：<a href="https://oi-wiki.org/ds/treap/#%E7%AE%80%E4%BB%8B">OI Wiki</a></div>

### 基本操作

**分裂**与**合并**。

#### 分裂

具体而言，就是将以 $p$ 为根的树以 $x$ 为键值分裂为两棵树，一棵以 $l$ 为根节点，一棵以 $r$ 为根节点。

~~这具体了个啥？？~~
---
layout: post
title: "题解："
subtitle: "题目见正文"
date: 2024-11-13
author: "TH911"
header-img: "img/2024/10/006.jpeg"
header-mask: 0.4
tags:
  - 题解
  - 线段树
---

## 题目

> | 时间限制 | 空间限制 | 输入文件名 | 输出文件名 |
> | :------: | :------: | :--------: | :--------: |
> | $3000ms$ | $512MB$  | `good.in`  | `good.out` |

### 题目描述

给定两个长度为 $n$ 的序列 $a$ 和 $b$。

从 $1$ 扫到 $n$，对于第 $i$ 个数，会有三种可能的操作：

1. 将 $a_i$ 加入数组 $c$，概率为 $p_i$。
2. 将 $b_i$ 加入数组 $c$，概率为 $q_i$。
3. 什么都不干，概率为 $1-p_i-q_i$。

记 $d$ 为  $c$从小到大排序后的数组，问 $\sum\limits_{i=1}^{\vert d\vert }i\times d_i$ 的期望，答案对 $P=10^9+7$ 取模。

### 输入格式

输入的第一行包含一个正整数 $n$，保证 $n\leq5\times10^6$。

接下来 $n$ 行每行包含 $4$ 个非负整数 $a_i,b_i,p_i',q_i'$。其中 $p_i',q_i'$ 分别表示 $p_i, q_i$ 在模 $P$ 意义下的值。保证 $0\leq a_i,b_i,p_i',q_i'<P$。

### 输出格式

输出一个数，表示最后的答案。

### 输入输出样例

#### 输入样例

```
1
0 1 499122177 499122177
```

#### 输出样例

```
499122177
```

### 说明/提示

#### 样例解释

最后的序列 $d$ 有两种情况：

1. $0$，概率在模 $P$ 意义下为 $499122177$，贡献为 $0\times499122177=0$。
2. $1$，概率在模 $P$ 意义下为 $499122177$，贡献为 $1\times499122177=499122177$。

故最后的期望为 $499122177$。

#### 数据范围

|   测试点   |    $n\leq$    |   特殊性质   |
| :--------: | :-----------: | :----------: |
|    $1$     |     $14$      | 保证 $q_i=0$ |
|    $2$     |     $14$      |      无      |
|   $3,4$    |     $500$     | 保证 $q_i=0$ |
|   $5,6$    |     $500$     |      无      |
|   $7,8$    |    $5000$     | 保证 $q_i=0$ |
|   $9,10$   |    $5000$     |      无      |
|    $11$    | $5\times10^5$ | 保证 $q_i=0$ |
|    $12$    |    $10^6$     | 保证 $q_i=0$ |
|    $13$    | $3\times10^6$ | 保证 $q_i=0$ |
|    $14$    | $5\times10^6$ | 保证 $q_i=0$ |
| $15\sim17$ | $5\times10^5$ |      无      |
|    $18$    |    $10^6$     |      无      |
|    $19$    | $3\times10^6$ |      无      |
|    $20$    | $5\times10^6$ |      无      |

#### 附件

[good.zip](/file/2024/11/good.zip)

## 题解

### 期望

首先，我们要明白期望到底是个什么东西。

可以理解为**平均值**，其实就是**每种情况的值与其出现概率之积的总和**。

举个例子，掷骰（**$\text t\acute{\text o}\text u$**）子，每个面掷到的概率都是 $\frac16$，那么掷到的数的**期望**为：$1\times\frac16+2\times\frac16+3\times\frac16+4\times\frac16+5\times\frac16+6\times\frac16=\frac72$。

### **题意分析**

首先，由于期望的